#!/bin/bash

### default
## name
declare -ga "_ga_exec_notify"
declare -ga "_ga_exec_wlcopy"
declare -ga "_ga_exec_notifyback"

declare -g "_gs_1_opt"
declare -gi "_gi_notify_action"

### argument
## variable
_gs_1_opt="${1}"

shift "1"


## option
case "${_gs_1_opt}" in
    "version")
        '/usr/bin/cat' "/usr/share/urlnotify/main/info/version"
        exit
        ;;
    "help")
        '/usr/bin/cat' "/usr/share/urlnotify/main/info/help"
        exit
        ;;
    "url")
        if [[ -z "${1}" ]] ; then
            echo -e "\n\033[31mERROR: URL is empty.\033[0m\n"
            exit "1"
        fi
        ;;
    *)
        echo -e "\n\033[31mERROR: Unkown option!\033[0m\n"
        '/usr/bin/cat' "/usr/share/urlnotify/main/info/version"
        exit "1"
        ;;
esac


### notify
## array
declare -ga "_ga_exec_notify"

_ga_exec_notify=(
    '/usr/bin/notify-send'
    --app-name="URLnotify"
    --icon="urlnotify"
    --urgency="critical"
    --action=1="Copy"
    --action=0="Close"
    --
    "A program wants to open a URL."
    "${@}"
)


## execute
_gi_notify_action="$("${_ga_exec_notify[@]}")"


### wl-copy
## array
_ga_exec_wlcopy=(
    '/usr/bin/wl-copy'
    --trim-newline
    --
    "${@}"
)

_ga_exec_notifyback=(
    '/usr/bin/notify-send'
    --app-name="URLnotify"
    --icon="urlnotify"
    --urgency="normal"
    --
)

## action
case "${_gi_notify_action}" in
    "0")
        "${_ga_exec_notifyback[@]}" "Action 0" "Nothing happened."
        echo -e "\n\033[31mERROR: Nothing happened.\033[0m\n"
        ;;
    "1")
        "${_ga_exec_wlcopy[@]}"
        "${_ga_exec_notifyback[@]}" "Action 1" "Copy successful."
        echo -e "\n\033[31mSUCCESS: Copy successful.\033[0m\n"
        ;;
    *)
        "${_ga_exec_notifyback[@]}" "Action *" "Unkown action."
        echo -e "\n\033[31mERROR: Unkown action!\033[0m\n"
        exit "1"
        ;;
esac
