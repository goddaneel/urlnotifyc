#!/bin/bash


## name
declare -ga "_ga_exec_notifyurl"
declare -ga "_ga_exec_wlcopy"
declare -ga "_ga_exec_notifyaction"

declare -g "_gs_1_opt"
declare -gi "_gi_notify_action"


## variable
_gs_1_opt="${1}"

shift "1"

_ga_exec_notifyurl=(
    '/usr/bin/notify-send'
    --app-name="URLnotify"
    --icon="urlnotify"
    --urgency="critical"
    --action=1="Copy"
    --action=0="Close"
    --
    "URL Notify"
    "${@}"
)

_ga_exec_notifyaction=(
    '/usr/bin/notify-send'
    --app-name="URLnotify"
    --icon="urlnotify"
    --urgency="normal"
    --
)

_ga_exec_wlcopy=(
    '/usr/bin/wl-copy'
    --trim-newline
    --
    "${@}"
)



## option
case "${_gs_1_opt}" in
    "version")
        '/usr/bin/cat' "/usr/share/urlnotify/main/info/version"
        exit
        ;;
    "help")
        '/usr/bin/cat' "/usr/share/urlnotify/main/info/help"
        exit
        ;;
    "url")
        if [[ -z "${1}" ]] ; then
            echo -e "\n\033[31mERROR: URL is invalid.\033[0m\n"
            "${_ga_exec_notifyaction[@]}" "ERROR" "URL is invalid."
            exit "1"
        fi
        ;;
    *)
        echo -e "\n\033[31mERROR: Unkown option!\033[0m\n"
        '/usr/bin/cat' "/usr/share/urlnotify/main/info/help"
        exit "1"
        ;;
esac


## url
_gi_notify_action="$("${_ga_exec_notifyurl[@]}")"


## action
case "${_gi_notify_action}" in
    "0")
        "${_ga_exec_notifyaction[@]}" "Action 0" "Nothing happened."
        echo -e "\n\033[33mWARNING: Nothing happened.\033[0m\n"
        ;;
    "1")
        "${_ga_exec_wlcopy[@]}"
        "${_ga_exec_notifyaction[@]}" "Action 1" "Copy successful."
        echo -e "\n\033[36mCopy successful.\033[0m\n"
        ;;
    *)
        "${_ga_exec_notifyaction[@]}" "Action ERROR" "Unkown action."
        echo -e "\n\033[31mERROR: Unkown action!\033[0m\n"
        exit "1"
        ;;
esac

